<!DOCTYPE html>
<html lang="pt-PT">
<head>
  <meta charset="UTF-8" />
  <title>Alhandra Rio | Painel de Controlo</title>
  
  <link rel="stylesheet" href="{{ url_for('static', filename='dashboard/messages.css') }}" />
  <link rel="shortcut icon" type="image/x-icon" href="{{ url_for('static', filename='shared/img/favicon.ico') }}">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>
</head>
<body>
  <div class="container">
    {% include "core/dashboardNavbar.html" %}

    <section class="main">
      <div class="main-top">
        <h1>Agenda</h1>
      </div>
      <section class="main-content">
          <div class="content">
                <div class="box">
                  <h3>Dummy!</h3>
                  <p><strong>Data:</strong> 24/01/2023</p>
                  <p><strong>Professor:</strong> Louis Minerals</p>
                  <i class="fas fa-solid fa-chalkboard-user" style="color: #966100;"></i>
                  <p><strong>Tipo:</strong> CÃ³digo</p>

                  <button style="background-color: #966100;" onclick="'mailto:teste@teste.com?subject=INSIRA O ASSUNTO AQUI (Aula 24/01/2023)'">Enviar Mensagem</button>
                </div>
      </section>
      
      {% if user.type == 'STAFF' %}
        <button class="rounded-button" onclick="openForm()">
          <i class="fas fa-plus"></i>
        </button>
      {% endif %}

      <div id="popupForm" class="popup-box">
        <div class="popup-content">
          <form id="agenda-form" action="/submit-agenda" method="post">
            <h2>Novo Agendamento</h2><br>

            <label for="student">Aluno:</label>
            <select id="student" name="student">
              {% for student in students %}
                <option value="{{student.id}}">{{student.username}}</option>
              {% endfor %}
            </select>
      
            <label for="date">Data:</label>
            <input type="date" id="date" name="date" min="today">
      
            <label for="type">Tipo:</label>
            <select id="type" name="type">
              <option value="option1">Option 1</option>
              <option value="option2">Option 2</option>
              <option value="option3">Option 3</option>
            </select><br><br>
      
            <button class="submit-button" type="submit">Submit</button>
          </form>
          <button id="close-form-button" class="close-button" onclick="closeForm()">
            <i class="fa-solid fa-xmark"></i>
          </button>
        </div>
      </div>

      {% include "shared/notification.html" %}

      <script>
        var today = new Date().toISOString().split('T')[0];
        document.getElementsByName("date")[0].setAttribute('min', today);

        
        function openForm() {
          document.querySelector('.popup-box').style.display = 'block'
          document.querySelector('body').style.overflow = 'hidden'
        }

        function closeForm() {
          document.querySelector('.popup-box').style.display = 'none'
          document.querySelector('body').style.overflow = 'auto'
        }

        const popupForm = document.querySelector('.popup-box')
        const closeButton = document.getElementById('close-form-button')

        const form = document.querySelector('#agenda-form')

        form.addEventListener('submit', async (event) => {
          event.preventDefault()
          event.stopPropagation()

          const formData = new FormData(form)
          const url = form.action
          const response = await fetch(url, {
            method: 'POST',
            body: formData
          }).then(response => {
            if(!response.ok) {
              throw new Error(`HTTP ${response.status} ${response.statusText}`)
            }

            closeForm()
            sendNotification("sucess", "Sucesso!", "Agendamento criado com sucesso.")
            console.log("The form has been sucessfully sent to the remote server: ", response.status)
          }).catch((error) => {
            closeForm()
            sendNotification("error", "Ocorreu um erro!", `Tente novamente mais tarde.`)
            throw error;
          })
        })
      </script>

      <script src="{{ url_for('static', filename='shared/js/Notification.js') }}"></script>

    </section>
    </section>
  </div>
</body>
</html>
